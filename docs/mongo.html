

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. Cloudmesh Database (ok) &mdash; Cloudmesh v4 alpha documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Manual (ok)" href="manual.html" />
    <link rel="prev" title="5. Configuration (ok)" href="configuration.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Cloudmesh v4
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">1. About</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">2. Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">3. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">4. Quickstart (proposed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">5. Configuration (ok)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">6. Cloudmesh Database (ok)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#database-decorator">6.1. Database Decorator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="manual.html">7. Manual (ok)</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-dev.html">8. Manual (proposed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">9. Jupyter Integration (proposed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vm.html">10. Virtual Machine Management (proposed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">11. Infrastructure Workflow (proposed)</a></li>
<li class="toctree-l1"><a class="reference internal" href="code.html">12. Code Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Outdated:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="goal.html">1. Goal (outdated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="goal.html#manual-cloudmesh-multi-service-data-access">2. Manual: Cloudmesh Multi Service Data Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="vmproviders.html">3. VM Providers (outdated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vagrant.html">4. Vagrant (outdated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="CM4README.html">5. CM4 Details (outdated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="aws.html">6. AWS cm (outdated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ufo.html">7. REST Service (outdated)</a></li>
<li class="toctree-l1"><a class="reference internal" href="vcluster.html">8. Virtual Cluster (in progress)</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cloudmesh v4</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>6. Cloudmesh Database (ok)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/mongo.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cloudmesh-database-ok">
<h1>6. Cloudmesh Database (ok)<a class="headerlink" href="#cloudmesh-database-ok" title="Permalink to this headline">¶</a></h1>
<p>Cloudmesh stores its status in a database so that you can easily remember which
services you used where and have an accurate account of them. We use as a
database mongoDB to store this information. To use cloudmesh you simply need to
create and start the database service.</p>
<p>First, you need to create a MongoDB database with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cms admin mongo create
</pre></div>
</div>
<p>Second, you need to start it with below command (for windows platform, open a new command prompt)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cms admin mongo start
</pre></div>
</div>
<p>Now you can interact with it to find out the status, the stats, and the database
listing with the commands</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cms admin mongo status
$ cms admin mongo stats
$ cms admin mongo list
</pre></div>
</div>
<p>To stop it from running use the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cms admin mongo stop
</pre></div>
</div>
<p>The database will be started on the information as specified in
<code class="docutils literal notranslate"><span class="pre">~/.cloudmesh/cloudmesh4.yaml</span></code></p>
<p>An example is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">mongo</span><span class="p">:</span>
      <span class="n">MONGO_AUTOINSTALL</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">MONGO_BREWINSTALL</span><span class="p">:</span> <span class="kc">False</span>
      <span class="n">LOCAL</span><span class="p">:</span> <span class="o">~/</span><span class="n">local</span>
      <span class="n">MONGO_HOME</span><span class="p">:</span> <span class="o">~/</span><span class="n">local</span><span class="o">/</span><span class="n">mongo</span>
      <span class="n">MONGO_PATH</span><span class="p">:</span> <span class="o">~/.</span><span class="n">cloudmesh</span><span class="o">/</span><span class="n">mongodb</span>
      <span class="n">MONGO_LOG</span><span class="p">:</span> <span class="o">~/.</span><span class="n">cloudmesh</span><span class="o">/</span><span class="n">mongodb</span><span class="o">/</span><span class="n">log</span>
      <span class="n">MONGO_DBNAME</span><span class="p">:</span> <span class="s1">&#39;cloudmesh&#39;</span>
      <span class="n">MONGO_HOST</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span>
      <span class="n">MONGO_PORT</span><span class="p">:</span> <span class="s1">&#39;27017&#39;</span>
      <span class="n">MONGO_USERNAME</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span>
      <span class="n">MONGO_PASSWORD</span><span class="p">:</span> <span class="n">TBD</span>
      <span class="n">MONGO_DOWNLOAD</span><span class="p">:</span>
        <span class="n">darwin</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">fastdl</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">osx</span><span class="o">/</span><span class="n">mongodb</span><span class="o">-</span><span class="n">osx</span><span class="o">-</span><span class="n">ssl</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mf">4.0</span><span class="o">.</span><span class="mf">4.</span><span class="n">tgz</span>
        <span class="n">linux</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">fastdl</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">mongodb</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mf">4.0</span><span class="o">.</span><span class="mf">4.</span><span class="n">tgz</span>
        <span class="n">win32</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">fastdl</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">win32</span><span class="o">/</span><span class="n">mongodb</span><span class="o">-</span><span class="n">win32</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mi">2008</span><span class="n">plus</span><span class="o">-</span><span class="n">ssl</span><span class="o">-</span><span class="mf">4.0</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="n">signed</span><span class="o">.</span><span class="n">msi</span>
        <span class="n">redhat</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="o">.</span><span class="n">mongodb</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">yum</span><span class="o">/</span><span class="n">redhat</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="n">mongodb</span><span class="o">-</span><span class="n">org</span><span class="o">/</span><span class="mf">4.0</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="n">RPMS</span><span class="o">/</span><span class="n">mongodb</span><span class="o">-</span><span class="n">org</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="mf">4.0</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="mf">1.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span>
</pre></div>
</div>
<p>We also provide a convenient install script that downloads the version defined
in the yaml file and installs it in the system with the command. In case of windows platform,
you will have to set the PATH variable manually after install</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cms admin mongo install
</pre></div>
</div>
<div class="section" id="database-decorator">
<h2>6.1. Database Decorator<a class="headerlink" href="#database-decorator" title="Permalink to this headline">¶</a></h2>
<p>Cloudmesh comes with a very convenient mechanism to integrate data into MongoDB.
All you have to do is to create a list of dictionaries with a function, that
returns this dictionary and use a decorator in the function to update the
information into the database.</p>
<p>The data base decorator automatically replaces an entry in the database with
the dictionary returned by a function.</p>
<p>It is added to a MongoDB collection. The location is determined from the
values in the dictionary.</p>
<p>The name of the collection is determined from cloud and kind:</p>
<p><code class="docutils literal notranslate"><span class="pre">cloud-kind</span></code></p>
<p>In addition each entry in the collection has a <code class="docutils literal notranslate"><span class="pre">name</span></code> that must be unique in
that collection.</p>
<p>In most examples it is best to separate the updload from the actual return
class. This way we essentially provide two functions one that provide the
dict and another that is responsible for the upload to the database.</p>
<p>Example:</p>
<p><code class="docutils literal notranslate"><span class="pre">cloudmesh.example.foo</span></code> contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Provider</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
           <span class="s2">&quot;cloud&quot;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
           <span class="s2">&quot;kind&quot;&quot;: &quot;</span><span class="n">entries</span><span class="s2">&quot;,</span>
           <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test01&quot;</span>
           <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cloudmesh.example.bar</span></code> contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Provider</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
           <span class="s2">&quot;cloud&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span>
           <span class="s2">&quot;kind&quot;&quot;: &quot;</span><span class="n">entries</span><span class="s2">&quot;,</span>
           <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test01&quot;</span>
           <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="s2">&quot;hello&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cloudmesh.example.provider.foo</span></code> contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cloudmesh.example.foo</span> <span class="k">import</span> <span class="n">Provider</span> <span class="k">as</span> <span class="n">FooProvider</span>
<span class="kn">from</span> <span class="nn">cloudmesh.example.foo</span> <span class="k">import</span> <span class="n">Provider</span> <span class="k">as</span> <span class="n">BarProvider</span>

<span class="k">class</span> <span class="nc">Provider</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">):</span>
       <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span><span class="p">:</span>
          <span class="n">provider</span> <span class="o">=</span> <span class="n">FooProvider</span><span class="p">()</span>
       <span class="k">elif</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span>
          <span class="n">provider</span> <span class="o">=</span> <span class="n">BarProvider</span><span class="p">()</span>

    <span class="nd">@DatabaseUpdate</span>
    <span class="k">def</span> <span class="nf">entries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">provider</span><span class="o">.</span><span class="n">entries</span><span class="p">()</span>
</pre></div>
</div>
<p>Separating the database and the dictionary creation allows the developer to
implement different providers but only use one class with the same methods
to interact for all providers with the database.</p>
<p>In the combined provider a find function to for example search for entries
by name across collections could be implemented.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="manual.html" class="btn btn-neutral float-right" title="7. Manual (ok)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration.html" class="btn btn-neutral" title="5. Configuration (ok)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Cloudmesh Community

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>